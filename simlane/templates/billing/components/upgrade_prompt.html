{% comment %}
Reusable upgrade prompt component for when features are restricted.
Usage: {% include "billing/components/upgrade_prompt.html" with feature_name="Race Planning" current_plan="Free" required_plan="Basic" %}
{% endcomment %}

<div class="bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg p-4 mb-4" 
     id="upgrade-prompt-{{ feature_name|slugify }}" 
     x-data="{ dismissed: false }" 
     x-show="!dismissed" 
     x-transition:enter="transition ease-out duration-300"
     x-transition:enter-start="opacity-0 transform scale-95"
     x-transition:enter-end="opacity-100 transform scale-100"
     x-transition:leave="transition ease-in duration-200"
     x-transition:leave-start="opacity-100 transform scale-100"
     x-transition:leave-end="opacity-0 transform scale-95">
  
  <div class="flex items-start">
    <!-- Warning Icon -->
    <div class="flex-shrink-0">
      <svg class="w-5 h-5 text-amber-400 dark:text-amber-500 mt-0.5" 
           fill="currentColor" 
           viewBox="0 0 20 20">
        <path fill-rule="evenodd" 
              d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" 
              clip-rule="evenodd" />
      </svg>
    </div>
    
    <!-- Content -->
    <div class="ml-3 flex-1">
      <div class="flex items-start justify-between">
        <div class="flex-1">
          <h3 class="text-sm font-medium text-amber-800 dark:text-amber-200">
            {{ feature_name|default:"This feature" }} requires an upgrade
          </h3>
          <div class="mt-2 text-sm text-amber-700 dark:text-amber-300">
            <p>
              Your current <span class="font-semibold">{{ current_plan|default:"Free" }}</span> plan doesn't include access to {{ feature_name|default:"this feature"|lower }}.
              {% if required_plan %}
                Upgrade to <span class="font-semibold">{{ required_plan }}</span> or higher to unlock this functionality.
              {% else %}
                Upgrade your plan to unlock this functionality.
              {% endif %}
            </p>
          </div>
          
          <!-- Pricing Information -->
          <div class="mt-3 space-y-2">
            <div class="text-xs text-amber-600 dark:text-amber-400">
              <strong>Available Plans:</strong>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 text-xs">
              <!-- Free Plan -->
              <div class="bg-white dark:bg-gray-800 border border-amber-200 dark:border-amber-700 rounded p-2 {% if current_plan == 'Free' %}ring-2 ring-amber-300 dark:ring-amber-600{% endif %}">
                <div class="font-semibold text-gray-900 dark:text-white">Free</div>
                <div class="text-gray-600 dark:text-gray-400">$0/month</div>
                <div class="text-gray-500 dark:text-gray-500 text-xs">• Up to 5 members</div>
                <div class="text-gray-500 dark:text-gray-500 text-xs">• Basic club features</div>
              </div>
              
              <!-- Basic Plan -->
              <div class="bg-white dark:bg-gray-800 border border-amber-200 dark:border-amber-700 rounded p-2 {% if current_plan == 'Basic' %}ring-2 ring-amber-300 dark:ring-amber-600{% elif required_plan == 'Basic' %}ring-2 ring-primary-300 dark:ring-primary-600{% endif %}">
                <div class="font-semibold text-gray-900 dark:text-white">Basic</div>
                <div class="text-gray-600 dark:text-gray-400">$9.99/month</div>
                <div class="text-gray-500 dark:text-gray-500 text-xs">• Up to 25 members</div>
                <div class="text-gray-500 dark:text-gray-500 text-xs">• Race planning</div>
                <div class="text-gray-500 dark:text-gray-500 text-xs">• Advanced analytics</div>
              </div>
              
              <!-- Pro Plan -->
              <div class="bg-white dark:bg-gray-800 border border-amber-200 dark:border-amber-700 rounded p-2 {% if current_plan == 'Pro' %}ring-2 ring-amber-300 dark:ring-amber-600{% elif required_plan == 'Pro' %}ring-2 ring-primary-300 dark:ring-primary-600{% endif %}">
                <div class="font-semibold text-gray-900 dark:text-white">Pro</div>
                <div class="text-gray-600 dark:text-gray-400">$19.99/month</div>
                <div class="text-gray-500 dark:text-gray-500 text-xs">• Unlimited members</div>
                <div class="text-gray-500 dark:text-gray-500 text-xs">• All features</div>
                <div class="text-gray-500 dark:text-gray-500 text-xs">• Priority support</div>
              </div>
            </div>
          </div>
          
          <!-- Action Buttons -->
          <div class="mt-4 flex flex-col sm:flex-row gap-2">
            {% if club %}
              <a href="{% url 'billing:start_checkout' club.slug %}?plan={{ required_plan|default:'Basic'|lower }}" 
                 class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors duration-200">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                </svg>
                Upgrade to {{ required_plan|default:"Basic" }}
              </a>
              <a href="{% url 'billing:subscription_dashboard' club.slug %}" 
                 class="inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors duration-200">
                View Billing
              </a>
            {% else %}
              <button type="button" 
                      class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors duration-200"
                      onclick="window.location.href='#upgrade'">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                </svg>
                Upgrade Plan
              </button>
            {% endif %}
          </div>
        </div>
        
        <!-- Dismiss Button -->
        <div class="ml-4 flex-shrink-0">
          <button type="button" 
                  class="inline-flex text-amber-400 dark:text-amber-500 hover:text-amber-600 dark:hover:text-amber-400 focus:outline-none focus:text-amber-600 dark:focus:text-amber-400 transition-colors duration-200"
                  @click="dismissed = true"
                  aria-label="Dismiss upgrade prompt">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" 
                    d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" 
                    clip-rule="evenodd" />
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Session storage to remember dismissed state -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const promptId = 'upgrade-prompt-{{ feature_name|slugify }}';
    const prompt = document.getElementById(promptId);
    
    if (prompt) {
      // Check if this prompt was previously dismissed in this session
      const dismissedKey = 'dismissed_' + promptId;
      if (sessionStorage.getItem(dismissedKey) === 'true') {
        prompt.style.display = 'none';
      }
      
      // Save dismissed state when user dismisses
      const dismissButton = prompt.querySelector('[aria-label="Dismiss upgrade prompt"]');
      if (dismissButton) {
        dismissButton.addEventListener('click', function() {
          sessionStorage.setItem(dismissedKey, 'true');
        });
      }
    }
  });
</script>