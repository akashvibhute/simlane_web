{% load static i18n %}

{% get_current_language as LANGUAGE_CODE %}
<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}" class="h-full">
  <head>
    <title>
      {% block title %}
        SimLane
      {% endblock title %}
    </title>
    {% include 'components/head.html' %}
    <script>
      // On page load or when changing themes, best to add inline in `head` to avoid FOUC
      if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark')
      } else {
        document.documentElement.classList.remove('dark')
      }
    </script>
    {% block head_scripts %}
      <script>
        window.isAuthenticated = {{ request.user.is_authenticated|yesno:"true,false" }};
      </script>
    {% endblock %}
  </head>
  <body hx-headers='{"x-csrftoken": "{{ csrf_token }}"}'
        class="{% block bodyclass %}bg-gray-50 dark:bg-gray-900 min-h-screen flex flex-col{% endblock bodyclass %}">
    {% block body %}
      <div class="flex-grow flex flex-col">
        {% include 'components/navbar.html' %}
        <div class="max-w-7xl w-full mx-auto px-4 sm:px-6 lg:px-8 pt-4">
          {% include 'components/messages.html' %}
          <main id="main-content">
            {% block main %}
              {% block content %}
                <div class="text-center py-12">
                  <p class="text-lg text-gray-600 dark:text-gray-400">Use this document as a way to quick start any new project.</p>
                </div>
              {% endblock content %}
            {% endblock main %}
          </main>
        </div>
      </div>
      {% include 'components/footer.html' %}
    {% endblock body %}
    {% block modal %}
    {% endblock modal %}
    {% block inline_javascript %}
      <script>
        // Theme toggle functionality
        function setTheme(theme) {
          if (theme === 'dark') {
            document.documentElement.classList.add('dark');
            localStorage.theme = 'dark';
          } else if (theme === 'light') {
            document.documentElement.classList.remove('dark');
            localStorage.theme = 'light';
          } else {
            localStorage.removeItem('theme');
            if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
              document.documentElement.classList.add('dark');
            } else {
              document.documentElement.classList.remove('dark');
            }
          }
          // Update all theme toggle buttons visual state
          document.querySelectorAll('[data-theme-value]').forEach(button => {
            const isActive = button.dataset.themeValue === theme ||
              (theme === 'system' && button.dataset.themeValue === 'system') ||
              (!localStorage.theme && button.dataset.themeValue === 'system');

            if (isActive) {
              button.classList.add('bg-primary-600', 'text-white');
              button.classList.remove('text-gray-600', 'dark:text-gray-400');
            } else {
              button.classList.remove('bg-primary-600', 'text-white');
              button.classList.add('text-gray-600', 'dark:text-gray-400');
            }
            button.setAttribute('aria-pressed', isActive);
          });
        }

        // Initialize theme state on page load
        document.addEventListener('DOMContentLoaded', function() {
          const currentTheme = localStorage.theme || 'system';
          setTheme(currentTheme);
        });

        // Watch for system theme changes
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', ({
          matches
        }) => {
          if (!localStorage.theme) {
            setTheme(matches ? 'dark' : 'light');
          }
        });

        function toggleMobileMenu() {
          const menu = document.getElementById('mobile-menu');
          menu.classList.toggle('hidden');
        }

        function toggleUserDropdown() {
          const dropdown = document.getElementById('user-dropdown');
          const arrow = document.getElementById('dropdown-arrow');
          const button = document.getElementById('user-dropdown-button');

          if (dropdown.classList.contains('hidden')) {
            // Show dropdown
            dropdown.classList.remove('hidden');
            // Trigger reflow to ensure transition works
            dropdown.offsetHeight;
            dropdown.classList.remove('opacity-0', 'scale-95');
            dropdown.classList.add('opacity-100', 'scale-100');
            arrow.style.transform = 'rotate(180deg)';
            button.setAttribute('aria-expanded', 'true');
          } else {
            // Hide dropdown
            dropdown.classList.remove('opacity-100', 'scale-100');
            dropdown.classList.add('opacity-0', 'scale-95');
            arrow.style.transform = 'rotate(0deg)';
            button.setAttribute('aria-expanded', 'false');
            // Wait for transition to complete before hiding
            setTimeout(() => {
              dropdown.classList.add('hidden');
            }, 100);
          }
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
          const dropdown = document.getElementById('user-dropdown');
          const button = document.getElementById('user-dropdown-button');

          if (dropdown && button && !button.contains(event.target) && !dropdown.contains(event.target)) {
            if (!dropdown.classList.contains('hidden')) {
              toggleUserDropdown();
            }
          }
        });

        // Close dropdown on escape key
        document.addEventListener('keydown', function(event) {
          if (event.key === 'Escape') {
            const dropdown = document.getElementById('user-dropdown');
            if (dropdown && !dropdown.classList.contains('hidden')) {
              toggleUserDropdown();
            }
          }
        });
      </script>
      {% comment %}
    Script tags with only code, no src (defer by default). To run
    with a "defer" so that you run inline code:
    <script>
      window.addEventListener('DOMContentLoaded', () => {
        /* Run whatever you want */
      });
    </script>
      {% endcomment %}
    {% endblock inline_javascript %}
  </body>
</html>
